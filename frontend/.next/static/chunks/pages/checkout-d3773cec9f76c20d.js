(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{7250:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return a(3646)}])},3646:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return f}});var t=a(5893),r=a(7294),l=a(1163),n=a(7536),i=a(6312),c=a(3448),d=a(6190);function o(e){let{register:s,errors:a}=e;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Shipping Address"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label-field",children:"Full Name *"}),(0,t.jsx)("input",{type:"text",...s("fullName"),className:"input-field",placeholder:"John Doe"}),a.fullName&&(0,t.jsx)("p",{className:"error-message",children:a.fullName.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label-field",children:"Phone Number *"}),(0,t.jsx)("input",{type:"tel",...s("phone"),className:"input-field",placeholder:"+254 700 000 000"}),a.phone&&(0,t.jsx)("p",{className:"error-message",children:a.phone.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label-field",children:"Address *"}),(0,t.jsx)("textarea",{...s("address"),className:"input-field",rows:3,placeholder:"Street address, apartment, suite, etc."}),a.address&&(0,t.jsx)("p",{className:"error-message",children:a.address.message})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label-field",children:"City *"}),(0,t.jsx)("input",{type:"text",...s("city"),className:"input-field",placeholder:"Nairobi"}),a.city&&(0,t.jsx)("p",{className:"error-message",children:a.city.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label-field",children:"Postal Code"}),(0,t.jsx)("input",{type:"text",...s("postalCode"),className:"input-field",placeholder:"00100"}),a.postalCode&&(0,t.jsx)("p",{className:"error-message",children:a.postalCode.message})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label-field",children:"Country *"}),(0,t.jsx)("input",{type:"text",...s("country"),className:"input-field",placeholder:"Kenya",defaultValue:"Kenya"}),a.country&&(0,t.jsx)("p",{className:"error-message",children:a.country.message})]})]})}var u=a(4777),m=a(5536);function p(){let e=(0,m.x)(e=>e.items),s=(0,m.x)(e=>e.getTotal());return(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Order Summary"}),(0,t.jsx)("div",{className:"space-y-3 mb-4",children:e.map(e=>(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:e.product.name}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Qty: ",e.quantity]})]}),(0,t.jsx)("p",{className:"font-medium",children:(0,u.T4)(e.product.price*e.quantity)})]},e.product._id))}),(0,t.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Subtotal"}),(0,t.jsx)("span",{className:"font-medium",children:(0,u.T4)(s)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Shipping"}),(0,t.jsx)("span",{className:"font-medium",children:(0,u.T4)(200)})]}),(0,t.jsxs)("div",{className:"border-t pt-2 flex justify-between text-lg",children:[(0,t.jsx)("span",{className:"font-bold",children:"Total"}),(0,t.jsx)("span",{className:"font-bold text-brown-700",children:(0,u.T4)(s+200)})]})]})]})}var h=a(6609),x=a(4665),y=a(8070),j=a(6501);let b=c.Ry({fullName:c.Z_().min(2,"Full name is required"),phone:c.Z_().min(10,"Valid phone number is required"),address:c.Z_().min(5,"Address is required"),city:c.Z_().min(2,"City is required"),postalCode:c.Z_().optional(),country:c.Z_().min(2,"Country is required"),paymentMethod:c.Z_().min(1,"Payment method is required")});function f(){let e=(0,l.useRouter)(),[s,a]=(0,r.useState)(!1),c=(0,m.x)(e=>e.items),u=(0,m.x)(e=>e.clearCart),f=(0,x.t)(e=>e.isAuthenticated),{register:g,handleSubmit:N,formState:{errors:v}}=(0,n.cI)({resolver:(0,i.F)(b),defaultValues:{country:"Kenya",paymentMethod:"mpesa"}});(0,r.useEffect)(()=>{f||e.push("/auth/login?redirect=/checkout"),0===c.length&&e.push("/cart")},[f,c.length,e]);let w=async s=>{a(!0);try{let a={items:c.map(e=>({product:e.product._id,quantity:e.quantity,price:e.product.price})),shippingAddress:s,paymentMethod:s.paymentMethod},t=await y.kn.create(a);u(),j.ZP.success("Order placed successfully!"),e.push("/orders/".concat(t._id))}catch(e){var t,r;j.ZP.error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"Failed to place order")}finally{a(!1)}};return f&&0!==c.length?(0,t.jsx)(d.Z,{title:"Checkout - Yarnitt",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),(0,t.jsx)("form",{onSubmit:N(w),children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[(0,t.jsx)("div",{className:"card",children:(0,t.jsx)(o,{register:g,errors:v})}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Payment Method"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("label",{className:"flex items-center space-x-3 p-4 border border-gray-300 rounded-button cursor-pointer hover:border-brown-600",children:[(0,t.jsx)("input",{type:"radio",value:"mpesa",...g("paymentMethod"),className:"text-brown-600 focus:ring-brown-600",defaultChecked:!0}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"M-Pesa"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Pay with M-Pesa mobile money"})]})]}),(0,t.jsxs)("label",{className:"flex items-center space-x-3 p-4 border border-gray-300 rounded-button cursor-pointer hover:border-brown-600",children:[(0,t.jsx)("input",{type:"radio",value:"card",...g("paymentMethod"),className:"text-brown-600 focus:ring-brown-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Credit/Debit Card"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Pay with card"})]})]}),(0,t.jsxs)("label",{className:"flex items-center space-x-3 p-4 border border-gray-300 rounded-button cursor-pointer hover:border-brown-600",children:[(0,t.jsx)("input",{type:"radio",value:"cash",...g("paymentMethod"),className:"text-brown-600 focus:ring-brown-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Cash on Delivery"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Pay when you receive"})]})]})]}),v.paymentMethod&&(0,t.jsx)("p",{className:"error-message mt-2",children:v.paymentMethod.message})]})]}),(0,t.jsxs)("div",{className:"lg:col-span-1",children:[(0,t.jsx)(p,{}),(0,t.jsx)(h.Z,{type:"submit",isLoading:s,className:"w-full mt-4",size:"lg",children:"Place Order"})]})]})})]})}):null}},6609:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});var t=a(5893);a(7294);var r=a(4777);function l(e){let{variant:s="primary",size:a="md",isLoading:l=!1,className:n,children:i,disabled:c,...d}=e;return(0,t.jsx)("button",{className:(0,r.cn)("rounded-button font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-brown-600 text-white hover:bg-brown-700",secondary:"bg-gray-200 text-gray-800 hover:bg-gray-300",outline:"border border-brown-600 text-brown-600 hover:bg-brown-50"}[s],{sm:"px-3 py-1 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[a],n),disabled:c||l,...d,children:l?(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"loading-spinner h-5 w-5"})}):i})}},8070:function(e,s,a){"use strict";a.d(s,{fi:function(){return i},g8:function(){return d},iJ:function(){return n},kn:function(){return c}});var t=a(7066),r=a(4777);let l=t.Z.create({baseURL:"http://localhost:4000",headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{let s=(0,r.bW)();return s&&(e.headers.Authorization="Bearer ".concat(s)),e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,e=>{var s;return(null===(s=e.response)||void 0===s?void 0:s.status)===401&&((0,r.H6)(),window.location.href="/auth/login"),Promise.reject(e)});let n={login:async e=>(await l.post("/api/auth/login",e)).data,register:async e=>(await l.post("/api/auth/register",e)).data,logout:async()=>{(0,r.H6)()}},i={getAll:async e=>(await l.get("/products",{params:e})).data,getById:async e=>(await l.get("/products/".concat(e))).data,getBySeller:async e=>(await l.get("/products/seller/".concat(e))).data},c={create:async e=>(await l.post("/api/orders",e)).data,getBuyerOrders:async()=>(await l.get("/api/orders/buyer")).data,getById:async e=>(await l.get("/api/orders/".concat(e))).data,cancelOrder:async e=>(await l.patch("/api/orders/".concat(e,"/cancel"))).data},d={getById:async e=>(await l.get("/api/users/".concat(e))).data,updateProfile:async(e,s)=>(await l.patch("/api/users/".concat(e),s)).data}}},function(e){e.O(0,[843,66,154,479,888,774,179],function(){return e(e.s=7250)}),_N_E=e.O()}]);